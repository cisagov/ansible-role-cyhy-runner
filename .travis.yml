---
dist: xenial
language: python
python: 3.7
# pre-commit hooks can use Docker, so we should go ahead and enable it
services: docker

env:
  global:
    - AWS_DEFAULT_REGION="us-east-1"
    # AWS_ACCESS_KEY_ID
    - secure: "RzS2U2nWgACEtGRKEZLq+wAI0DigkRCU5AUnDdKSlydX88vK1GP6glw\
      MdEUDztpx6c2AhwwPBx2h3f9SvAXoWfOOPWkisnKaXW6OvGu7z7/J74HvUBuDPEd\
      Zz3MuQ0jPUriP3GVx4uxy/x3yzXQ5Bc0ncGEOtz0uoOZoGVKkdeps1Zzi6Zz1z/V\
      MxoJjJDwESJyIl2fNNqkP7TG8Om2M06mG+rIGv89zkPbGIR0UomCUJuMwqVgZwVt\
      Ofm5qAUzPFWg1pdAwGKkl0sJ8L1FS+rmLDcEvpehO9O5NED4JNFmU8nfnbqRCIvC\
      s/WNbHCfAcVSYGLUcQPkyLXEu0u/dMS+ezP59keLdO668xj8sfpc3DjA4aB6oZaJ\
      Y6XIxywJCuYezsx9ynoT4SHc8IFXKFcEXA9DHw08ygthddpE6gbSIwdN90L4eX0d\
      GXW3m8sQfOocLULm7q6sLNPU53hhTUbzIMe38RZ27T8Tnc1mx49Z3Ow/Mte/2hQQ\
      D8dUXNe5r5VAMW/2WU1PryJaYPQPWUm10nNPQT/wXcWUWzxcc0PZcTGosUg1SFsT\
      5rUTr2oRMCOT1bupK7qU3ibWm+MpbjzX5aLnqGjWQKbpVbxcc5JxpRVsrTr+yWnW\
      /4x7v4xKRZY3zc07v1GnqCMLmAt/86Uhd9JiBnttCmQzWQfkfngs="
    # AWS_SECRET_ACCESS_KEY
    - secure: "cLSi1BA/etHvBMOr03fS2Yfxkhnu09e6oRxRAgZKAhGz6HVzan83+ED\
      6Nddzrv7e0fTwffmmiBWmkHQZf3aYyxeFJFzupjYme7Wp61OXZp5Tf9aqBoUjVNQ\
      ukSdwstSKLBwLC4W3vicbCpNE1rm4ckL+Ovp/Py554bwk7Oe7+fO3xNfIgVmCrtA\
      +o1CX2mc+e/+KrT2sU4M7FzsRAovU0fkmTkMTAASgVMz6SKq6XupZ1Y77frkTl2F\
      oPTqFQg56EPW6VbSID+qWRE5s3TWMn4xS5JqF42Sna8bwEE3sSSmsMbJeTfwjxBK\
      8PueidF53vMNmKcX8zcONavW3br4h05hIgOAVzl1DZund7oho8Vbpwe+8ADoHPBz\
      S24txVJ7jEF41mlxIYUgnOtTdWlAkw9IsxJDb8wyXEFqCR/9TRMXMXoTCWwVoBhV\
      PPq/4cW1Th+vaLRNQWYAcETBlvYFbqXhT2TBH6T0VdWHiu5n6YEpvtz2pJY4LrhS\
      wamOf3cQOkU4/bYw7EM2PHv1zq0QJfovfA0NDAQjIf5cY6/mq8aj7aCzYrLU3aDm\
      9+nGdy5yKaxhejZNI6FeAzDgjRKPgzipgv+Unnxq87EE19j+rkEAl119i/1UPny5\
      ptnJ7Rt4xMISPp6tBSiRvu+QrP3u04TBO+cwHScd/3aAvo4vMZUA="

# Install terraform and terraform-doc
before_install:
  - >
    wget
    https://releases.hashicorp.com/terraform/0.12.3/terraform_0.12.3_linux_amd64.zip
    -O terraform.zip
  - sudo unzip terraform.zip -d /opt/terraform
  - sudo ln -s /opt/terraform/terraform /usr/bin/terraform
  - rm -f terraform.zip
  - go get github.com/segmentio/terraform-docs

# Cache pip packages and pre-commit plugins to speed up builds
cache:
  pip: true
  directories:
    - $HOME/.cache/pre-commit

install:
  - pip install --upgrade -r requirements-test.txt

script:
  - pre-commit run --all-files
  - molecule test
